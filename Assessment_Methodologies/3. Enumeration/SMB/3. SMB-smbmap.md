# 📁 Enumeration – SMB with `smbmap`

---

## 🎯 Purpose

`smbmap` is a post-exploitation tool for enumerating and interacting with Windows SMB shares.  
It allows pentesters to:
- List accessible shares
- Download/upload files
- Execute commands remotely (if permissions allow)

---

## 🔢 Default SMB Ports

| Protocol | Port  |
|----------|-------|
| SMB over NetBIOS | 139 |
| SMB over TCP     | 445 |

---

## 🧰 Prerequisites

- Install smbmap:
```bash
sudo apt install smbmap
````

---

## 🛠️ Step-by-Step Usage

---

### ✅ 1. Check if the Host is Up

```bash
ping IP
```

---

### ✅ 2. Identify SMB Protocol Version (Optional)

```bash
nmap -p445 --script smb-protocols IP
```

* Confirms supported SMB versions (SMBv1, SMBv2, etc.)

---

### ✅ 3. Anonymous SMB Access (Guest Login)

```bash
smbmap -u guest -p "" -d . -H IP
```

* `-u guest`: Username
* `-p ""`: Empty password
* `-d .`: Workgroup (use `.` for default)
* `-H IP`: Target host

---

### ✅ 4. Authenticated Login

```bash
smbmap -u administrator -p smbserverpassword -H IP
```

* Replace `smbserverpassword` with the actual password

---

### ✅ 5. Remote Command Execution

```bash
smbmap -H IP -u administrator -p smbserverpassword -x "ipconfig"
```

* Executes the `ipconfig` command on the remote host (if permitted)

---

### ✅ 6. List Output of Command

```bash
smbmap -H IP -u administrator -p smbserverpassword -x "ipconfig" -l
```

* `-l`: List the command output

---

### ✅ 7. Recursive Share Listing (e.g., C Drive)

```bash
smbmap -H IP -u administrator -p smbserverpassword -r 'C$'
```

* `-r 'C$'`: Recursively list contents of `C$` admin share

---

### ✅ 8. Upload a File (e.g., backdoor)

```bash
smbmap -H IP -u administrator -p smbserverpassword --upload /root/backdoor 'C$'\backdoor
```

* Uploads `backdoor` file to the remote `C$\backdoor` path

---

### ✅ 9. Download a File (e.g., flag.txt)

```bash
smbmap -H IP -u administrator -p smbserverpassword -r 'C$' --download 'C$\flag.txt'
```

* Downloads the `flag.txt` file from the C\$ share

---

## ⚠️ Notes

* Admin or valid user credentials are often required for full access.
* `C$`, `ADMIN$`, `IPC$` are **default hidden administrative shares**.
* Avoid using on live networks without permission.

---

## 🧠 Summary

| Task                | Command Example                               |
| ------------------- | --------------------------------------------- |
| Anonymous login     | `smbmap -u guest -p "" -d . -H IP`            |
| Authenticated login | `smbmap -u admin -p pass -H IP`               |
| Exec remote command | `smbmap -H IP -u admin -p pass -x "ipconfig"` |
| Upload file         | `--upload /path/file 'C$'\path`               |
| Download file       | `--download 'C$\file.txt'`                    |

---
